<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catfy</title>
  <link rel="icon" type="image/png" href="music/logo.png">
  <link rel="stylesheet" href="styles.css">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #000; 
      color: #fff; 
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      margin: auto;
      background-color: #333; 
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .track-list ul,
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar li > div {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .sidebar button {
      margin-left: 5px;
    }
    .hidden {
      display: none;
    }
    button {
      background-color: #444;
      border: none;
      padding: 5px 10px;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #555;
    }
    html, body {
  height: 135%;
  overflow-y: auto; /* Assure qu'on peut scroller verticalement */
}

body {
  scroll-behavior: smooth; /* Optionnel : rend le scroll fluide */
}
  </style>
</head>
<body>
  <div class="container">
    <h1>Cat Fy</h1>

    <audio id="audioPlayer" controls>
      <source id="audioSource" src="" type="audio/mp3">
      Votre navigateur ne supporte pas l'√©l√©ment audio.
    </audio>

    <div class="controls">
      <button onclick="playNextTrack()">‚è≠Ô∏è Suivant</button>
      <button onclick="playPlaylist()">‚ñ∂Ô∏è Lancer la playlist</button>
      <button onclick="toggleTrackList()">üéµ Voir / Cacher la liste des morceaux</button>
      <div class="track-list" id="trackListSection">
    </div>
    <div class="track-list">
      <h2>Liste des morceaux</h2>
      <input type="text" id="searchInput" placeholder="Rechercher un morceau..." oninput="filterTracks()" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none;">
      <ul id="trackList"></ul>
    </div>

    <div class="now-playing">
      <h2>En cours</h2>
      <img id="currentTrackImage" src="placeholder.jpg" alt="Image du morceau">
    </div>

    <div class="sidebar">
      <h2>Playlists sauvegard√©es</h2>
    <button onclick="toggleElement('playlistSection')">üìÇ Afficher/Masquer les playlists</button>
      <ul id="savedPlaylists"></ul>
      <button onclick="createPlaylist()">Cr√©er une playlist</button>
    </div>

    <div id="playlistMenu" class="hidden">
      <h3>Ajouter √† une playlist</h3>
      <ul id="playlistOptions"></ul>
      <button onclick="closePlaylistMenu()">Annuler</button>
    </div>
      <div id="g_id_onload"
     data-client_id="906015027286-btpg2s3gmga6adlhu19culi0hgb0trle.apps.googleusercontent.com"
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
</div>

<div class="g_id_signin"
     data-type="standard"
     data-shape="pill"
     data-theme="outline"
     data-text="signin_with"
     data-size="large"
     data-logo_alignment="left">
</div>
  </div>

  <script>
    const tracks = [
      { title: "Lya Funk", src: "music/track1.mp3", image: "music/image1.jpg" },
      { title: "Let's Gambling", src: "music/track2.mp3", image: "music/image2.jpg" },
      { title: "BLUE HORIZON FUNK", src: "music/track3.mp3", image: "music/image3.jpg" },
      { title: "Skyfall", src: "music/track4.mp3", image: "music/image4.jpg" },
      { title: "NEXT!", src: "music/track5.mp3", image: "music/image5.jpg" },
      { title: "Ela Vira Mortal", src: "music/track6.mp3", image: "music/image6.jpg" },
    ];

    let currentTrackIndex = 0;
    const audioPlayer = document.getElementById("audioPlayer");
    const audioSource = document.getElementById("audioSource");
    const trackListElement = document.getElementById("trackList");
    const currentTrackImage = document.getElementById("currentTrackImage");
    const playlistMenu = document.getElementById("playlistMenu");
    const playlistOptions = document.getElementById("playlistOptions");

    function loadTrackList() {
      trackListElement.innerHTML = "";
      tracks.forEach((track, index) => {
        const li = document.createElement("li");
        const isFavorite = getFavorites().includes(index);
        li.innerHTML = ` 
          <span onclick="playTrack(${index})">${track.title}</span>
          <button onclick="toggleFavorite(${index})">${isFavorite ? '‚≠ê' : '‚òÜ'}</button>
          <button onclick="openPlaylistMenu(${index})">‚ûï</button>
        `;
        trackListElement.appendChild(li);
      });
    }

    function playTrack(index) {
      currentTrackIndex = index;
      audioSource.src = tracks[index].src;
      currentTrackImage.src = tracks[index].image;
      audioPlayer.load();
      audioPlayer.play();
    }

    function playNextTrack() {
      currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
      playTrack(currentTrackIndex);
    }

    function playPlaylist() {
      playTrack(0);
      audioPlayer.onended = () => {
        playNextTrack();
      };
    }

    function getFavorites() {
      return JSON.parse(localStorage.getItem("favorites")) || [];
    }

    function toggleFavorite(index) {
      let favorites = getFavorites();
      if (favorites.includes(index)) {
        favorites = favorites.filter(i => i !== index);
        localStorage.setItem("favorites", JSON.stringify(favorites));
        removeFromPlaylist("Favoris", index);
      } else {
        favorites.push(index);
        localStorage.setItem("favorites", JSON.stringify(favorites));
        saveToPlaylist("Favoris", index);
      }
      loadTrackList();
    }

    function removeFromPlaylist(playlistName, trackIndex) {
      let playlists = JSON.parse(localStorage.getItem("playlists")) || [];
      let playlist = playlists.find(p => p.name === playlistName);
      if (playlist && playlist.tracks.includes(trackIndex)) {
        playlist.tracks = playlist.tracks.filter(i => i !== trackIndex);
        localStorage.setItem("playlists", JSON.stringify(playlists));
        loadPlaylists();
      }
    }

    function createPlaylist() {
      const name = prompt("Nom de la playlist :");
      if (name) {
        let playlists = JSON.parse(localStorage.getItem("playlists")) || [];
        playlists.push({ name, tracks: [] });
        localStorage.setItem("playlists", JSON.stringify(playlists));
        loadPlaylists();
      }
    }

    function loadPlaylists() {
      const savedPlaylists = document.getElementById("savedPlaylists");
      savedPlaylists.innerHTML = "";
      const playlists = JSON.parse(localStorage.getItem("playlists")) || [];
      playlists.forEach((playlist, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span onclick="togglePlaylistMenu(${index})" style="cursor:pointer; font-weight:bold;">${playlist.name}</span>
            <div>
              <button onclick="randomPlay(${index})">üîÄ</button>
              <button onclick="renamePlaylist(${index})">‚öôÔ∏è</button> 
              <button onclick="deletePlaylist(${index})">‚ùå</button> <!-- Bouton pour supprimer la playlist -->
              <button id="toggleBtn${index}" onclick="togglePlaylistMenu(${index})">‚ñ∂Ô∏è</button>
            </div>
          </div>
          <ul id="playlistTracks${index}" class="hidden"></ul>
        `;
        savedPlaylists.appendChild(li);
      });
    }

    function renamePlaylist(index) {
      const playlists = JSON.parse(localStorage.getItem("playlists")) || [];
      const playlist = playlists[index];
      const newName = prompt("Nouveau nom de la playlist :", playlist.name);
      if (newName) {
        playlist.name = newName;
        localStorage.setItem("playlists", JSON.stringify(playlists));
        loadPlaylists();
      }
    }

    function deletePlaylist(index) {
      let playlists = JSON.parse(localStorage.getItem("playlists")) || [];
      playlists.splice(index, 1);
      localStorage.setItem("playlists", JSON.stringify(playlists));
      loadPlaylists();  // Recharge la liste des playlists apr√®s la suppression
    }

    function togglePlaylistMenu(index) {
      const playlistTracks = document.getElementById(`playlistTracks${index}`);
      const toggleBtn = document.getElementById(`toggleBtn${index}`);
      if (playlistTracks.classList.contains("hidden")) {
        displayPlaylistTracks(index);
        playlistTracks.classList.remove("hidden");
        toggleBtn.textContent = "‚ñº";
      } else {
        playlistTracks.classList.add("hidden");
        toggleBtn.textContent = "‚ñ∂Ô∏è";
      }
    }

    function displayPlaylistTracks(playlistIndex) {
      const playlists = JSON.parse(localStorage.getItem("playlists")) || [];
      const playlist = playlists[playlistIndex];
      const playlistTracks = document.getElementById(`playlistTracks${playlistIndex}`);
      playlistTracks.innerHTML = "";

      playlist.tracks.forEach((trackIndex, trackOrderIndex) => {
        const li = document.createElement("li");
        li.style.display = "flex";
        li.style.justifyContent = "space-between";
        li.style.alignItems = "center";
        li.style.padding = "4px 0";

        const span = document.createElement("span");
        span.textContent = tracks[trackIndex].title;
        span.style.cursor = "pointer";
        span.onclick = function() {
          playPlaylistSequence(playlist.tracks, trackOrderIndex);
        };

        const removeBtn = document.createElement("button");
        removeBtn.textContent = "X";
        removeBtn.onclick = function(e) {
          e.stopPropagation();
          removeTrackFromPlaylist(playlistIndex, trackOrderIndex);
        };

        li.appendChild(span);
        li.appendChild(removeBtn);
        playlistTracks.appendChild(li);
      });
    }

    function playPlaylistSequence(trackArray, currentPlaylistIndex) {
      if (currentPlaylistIndex < trackArray.length) {
        const trackIndex = trackArray[currentPlaylistIndex];
        playTrack(trackIndex);
        audioPlayer.onended = function() {
          playPlaylistSequence(trackArray, currentPlaylistIndex + 1);
        };
      } else {
        playPlaylistSequence(trackArray, 0);
      }
    }

    function removeTrackFromPlaylist(playlistIndex, trackOrderIndex) {
      let playlists = JSON.parse(localStorage.getItem("playlists")) || [];
      if (playlists[playlistIndex] && playlists[playlistIndex].tracks[trackOrderIndex] !== undefined) {
        playlists[playlistIndex].tracks.splice(trackOrderIndex, 1);
        localStorage.setItem("playlists", JSON.stringify(playlists));
        displayPlaylistTracks(playlistIndex);
      }
    }

    function openPlaylistMenu(trackIndex) {
      playlistMenu.classList.remove("hidden");
      playlistOptions.innerHTML = "";
      let playlists = JSON.parse(localStorage.getItem("playlists")) || [];
      playlists.forEach((playlist, i) => {
        const li = document.createElement("li");
        li.textContent = playlist.name;
        li.onclick = () => {
          saveToPlaylist(playlist.name, trackIndex);
          closePlaylistMenu();
        };
        playlistOptions.appendChild(li);
      });
    }

    function closePlaylistMenu() {
      playlistMenu.classList.add("hidden");
    }

    function saveToPlaylist(playlistName, trackIndex) {
      let playlists = JSON.parse(localStorage.getItem("playlists")) || [];
      let playlist = playlists.find(p => p.name === playlistName);
      if (playlist && !playlist.tracks.includes(trackIndex)) {
        playlist.tracks.push(trackIndex);
        localStorage.setItem("playlists", JSON.stringify(playlists));
      }
      loadPlaylists();
    }

    function randomPlay(playlistIndex) {
      let playlists = JSON.parse(localStorage.getItem("playlists")) || [];
      const playlist = playlists[playlistIndex];
      if (playlist && playlist.tracks.length > 0) {
        let shuffled = playlist.tracks.slice();
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        playPlaylistSequence(shuffled, 0);
      }
    }
    

    window.onload = () => {
      let playlists = JSON.parse(localStorage.getItem("playlists")) || [];
      if (!playlists.some(p => p.name === "Favoris")) {
        playlists.push({ name: "Favoris", tracks: [] });
        localStorage.setItem("playlists", JSON.stringify(playlists));
      }
function toggleTrackList() {
  const trackList = document.querySelector(".track-list");
  if (trackList.classList.contains("hidden")) {
    trackList.classList.remove("hidden");
  } else {
    trackList.classList.add("hidden");
  }
}

      loadTrackList();
      loadPlaylists();
    };
  function filterTracks() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const trackList = document.getElementById("trackList");
    const tracks = trackList.getElementsByTagName("li");

    for (let i = 0; i < tracks.length; i++) {
      const trackName = tracks[i].textContent || tracks[i].innerText;
      if (trackName.toLowerCase().includes(input)) {
        tracks[i].style.display = "";
      } else {
        tracks[i].style.display = "none";
      }
    }
  }
  function updateNowPlaying(track) {
  document.getElementById("nowPlayingTitle").innerText = track.name;
  document.getElementById("currentMedia").src = track.imageUrl || "placeholder.jpg";
}
  function toggleTrackList() {
    const trackList = document.getElementById('trackListSection');
    trackList.classList.toggle('hidden');
  }
      function handleCredentialResponse(response) {
    // Le token JWT renvoy√© par Google
    const idToken = response.credential;

    // Tu peux le d√©coder pour afficher les infos de l'utilisateur
    const userData = parseJwt(idToken);
    console.log("Utilisateur connect√© :", userData);

    // Affiche par exemple son nom
    alert("Bienvenue, " + userData.name + " !");
  }

  function parseJwt(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(
      atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join('')
    );
    return JSON.parse(jsonPayload);
  }
  </script>
</body>
</html>
